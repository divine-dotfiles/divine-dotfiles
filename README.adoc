# Divine.dotfiles
:author: Grove Pyree
:email: grayarea@protonmail.ch
:revnumber: 0
:revdate: 2019.08.09
:revremark: Work in progress
:doctype: article
// Visual
:toc:
// Subs:

++++
<p align="center">
<em>Bash framework for dotfiles and everything Bash</em>
</p>
++++

[#divine-dotfiles-plaque]
image::lib/img/divine-dotfiles-plaque.png[Divine.dotfiles,align="center"]

New machine or new OS?
Set it up with a single `*di install --yes*`.

[NOTE]
--
`di` stands for **d**ivine **i**ntervention.
--

_Divine.dotfiles_ lets you keep your set-up routines as isolated _deployments_ that are installed/removed in defined sequence.

## In a nutshell

### Example deployment

Let's scratch the surface.
Here's a very basic deployment file:

[source,bash,subs="verbatim,attributes"]
----
# grail/dpls/example.dpl.sh

d_dpl_check() {
  [ -e ~/bin/cmd ] && return 1 {vbar}{vbar} return 2
}

d_dpl_install() {
  cat >~/bin/cmd <<<'echo Divine.dotfiles rocks' && chmod +x ~/bin/cmd
}

d_dpl_remove() {
  rm -f -- ~/bin/cmd
}
----

And here is what working with it looks like:

[#divine-dotfiles-example-1]
image::lib/img/divine-dotfiles-example-1.gif[Divine.dotfiles example 1,align="center"]

Dead simple, right?
You wouldn’t need a framework for that.
But wait, there’s [.small]#_(hopefully)_# more.

### Framework features

[horizontal]
Divinefile:: Special deployment that maintains a stable set of system packages across machines and OS's
Grail directory:: Store your deployments and assets (e.g., personal config files) in one place, which then, on a new machine, is easily plugged in from a repo or local dir
Groups:: Split your deployment collection into groups, and operate on them individually
Priorities:: Easily marshal your deployments in order, which is automatically reversed for uninstallation
Stash:: Persistent key-value store for use within your deployments
Queues:: Built-in mechanism for deployments that perform a series of similar tasks
Third-party deployments:: Attach pre-made deployments from Github (such as our glorious https://github.com/no-simpler/divine-dpls-core[core bundle]) without polluting your precious Grail [.small]#_(heh)_#

See?
_Divine.dotfiles_ is so good, it should be illegal.
And it is in some places.
Probably.
Don't quote me on that.

## Installation and uninstallation

### System requirements

* https://en.wikipedia.org/wiki/Unix-like[Unix-like OS].
Following OS distributions are openly supported:
+
--
** *Debian*
** *Fedora*
** *FreeBSD*
** *macOS*
** *Ubuntu*
--
+
NOTE: This list is incomplete; you can help by expanding it.

* `bash 3.2+` and either `curl` or `wget`
+
[NOTE]
--
`git` is not a hard requirement, but it is not flaccid either.
You can install _Divine.dotfiles_ without `git`.
But then it will bug you to no end for it, and even go so far as auto-install it when you launch any routine with `--yes` option.
--

### Installation

Run the following single command in Terminal:

[source,bash]
----
bash -c 'TMP=$(mktemp); URL=https://raw.github.com/no-simpler/divine-dotfiles/master/lib/install/install.sh; if curl --version &>/dev/null; then curl -fsSL $URL >$TMP; elif wget --version &>/dev/null; then wget -qO $TMP $URL; else printf >&2 "\n==> Error: failed to detect neither curl nor wget\n"; rm -f $TMP; exit 1; fi && chmod +x $TMP && $TMP "$@" || { printf >&2 "\n==> Error: failed to download installation script\n"; rm -f $TMP; exit 2; }' bash
----

NOTE: Installation is completely safe: it clones/downloads repository and creates one symlink.
Oh, and it asks for your permission for everything.

#### Installation options and overrides

Add flavoring to your installation as such:

[%header,cols="<.<1,<.<1",stripes=none]
|===

^.^|Prepend on the left
^.^|Append on the right

a|`*D_FMWK_DIR=_PATH_* bash -c '…`:: [.small]#Install framework within `*_PATH_*` instead of default `~/.divine`#
`*D_SHORTCUT_NAME=_CMD_* bash -c '…`:: [.small]#Name shortcut shell command `*_CMD_*` instead of default `di`#
`*D_SHORTCUT_DIR=_PATH_* bash -c '…`:: [.small]#Install shortcut shell command within `*_PATH_*` instead of choosing among directories on `$PATH`, as is default#

a|`…' bash *--yes*`:: [.small]#Install everything without prompts#
`…' bash *--no*`:: [.small]#Install absolutely nothing#
`…' bash *--framework-yes*`:: [.small]#Install framework without prompt#
`…' bash *--framework-no*`:: [.small]#Install absolutely nothing#
`…' bash *--shortcut-yes*`:: [.small]#Install shortcut shell command without prompt#
`…' bash *--shortcut-no*`:: [.small]#Skip installing shortcut shell command without prompt#
`…' bash *--verbose*`:: [.small]#Increase amount of output#
`…' bash *--quiet*`:: [.small]#[.gray]##_(default)_## Decrease amount of output#

|===

### Uninstallation

Run the following single command in Terminal:

[source,bash]
----
bash -c 'TMP=$(mktemp); URL=https://raw.github.com/no-simpler/divine-dotfiles/master/lib/uninstall/uninstall.sh; if curl --version &>/dev/null; then curl -fsSL $URL >$TMP; elif wget --version &>/dev/null; then wget -qO $TMP $URL; else printf >&2 "\n==> Error: failed to detect neither curl nor wget\n"; rm -f $TMP; exit 1; fi && chmod +x $TMP && $TMP "$@" || { printf >&2 "\n==> Error: failed to download uninstallation script\n"; rm -f $TMP; exit 2; }' bash
----

NOTE: After asking for permission, this will back up your Grail directory and usage data and then erase framework directory.

#### Uninstallation options and overrides

Add flavoring to your uninstallation as such:

[%header,cols="<.<,<.<",stripes=none]
|===

^.^|Prepend on the left
^.^|Append on the right

a|`*D_FMWK_DIR=_PATH_* bash -c '…`:: [.small]#Uninstall framework within `*_PATH_*` instead of default `~/.divine`#

a|`…' bash *--yes*`:: [.small]#Uninstall everything without prompts#
`…' bash *--no*`:: [.small]#Uninstall absolutely nothing#
`…' bash *--utils-yes*`:: [.small]#Uninstall system packages installed by the framework (e.g., `git`) without prompt#
`…' bash *--utils-no*`:: [.small]#Skip uninstalling system packages installed by the framework (e.g., `git`) without prompt#
`…' bash *--backup-yes*`:: [.small]#[.gray]##_(default)_## Make backup of Grail directory and usage data without prompt#
`…' bash *--backup-no*`:: [.small]#Do not make backup of Grail directory and usage data without prompt#
`…' bash *--framework-yes*`:: [.small]#Erase framework directory without prompt#
`…' bash *--framework-no*`:: [.small]#Uninstall absolutely nothing#
`…' bash *--verbose*`:: [.small]#Increase amount of output#
`…' bash *--quiet*`:: [.small]#[.gray]##_(default)_## Decrease amount of output#

|===